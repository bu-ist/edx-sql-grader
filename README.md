# SQL Grader

A external "Pull" grader for the edX platform capable of grading SQL queries.

## Requirements
- Python
- Dedicated XQueue queue
- XQueue authentication credentials

## Installation

```bash
mkdir /edx/app
cd /edx/app
git clone https://github.com/bu-ist/edx-sql-grader
cd edx-sql-grader
pip install -r requirements.txt
```

Usage of [virtualenv](http://www.virtualenv.org/en/latest/) is highly recommended.

## Configuration

The grader instance follows the same configuration convention as the [edX platform](https://github.com/edx/edx-platform).

Two configuration files are required before the grader can be started:

- grader.auth.json -- Database and XQueue credentials
- grader.env.json -- Environment configuration

These files must be placed in the parent directory of this code repository.
For instance if you cloned this repository into `/edx/app/edx-sql-grader`, then you would create `/edx/app/grader.{auth,env}.json`.

See the sample files included with this repository for example configuration values.

## Starting the grader

The `run.py` script will poll the configured XQueue inteface awaiting submissions.

You can run it from the command line for development purposes:

```bash
$ python run.py
```

Production setup coming soon...

## Creating a problem

In edX Studio, create a new unit and add a "Blank Common Problem" component.
Using the "Advanced Editor", add the following:

```xml
<problem display_name="External SQL Grader Problem">
   <text>
       <p>Write a query that returns the playerID and # of HRs for the top 10 HR hitters from 2010.</p>
   </text>
   <coderesponse queuename="my_course_queue">
       <textbox rows="10" cols="80" tabsize="4"/>
       <codeparam>
           <initial_display>
SELECT ...
           </initial_display>
           <answer_display>
SELECT playerID, HR
FROM  batting
WHERE yearID = 2010
ORDER BY HR DESC
LIMIT 10
           </answer_display>
           <grader_payload>
           {"answer": "SELECT playerID, HR FROM Batting WHERE yearID = 2010 ORDER BY HR DESC LIMIT 10", "database": "sabermetrics.sqlite", "grader": "sqlite"}
           </grader_payload>
       </codeparam>
   </coderesponse>
</problem>
```

Be sure to replace "my_course_queue" with your dedicated XQueue queue name.

### Grader Payload

The SQL grader requires a specially formatted JSON string to handle submissions correctly:

- answer -- The canonical answer query. The results of this query will be compared against those generated by the student response.
- database -- The name of the database to run the queries against.
- grader -- Grader to use (mysql|sqlite). fOptional. Defaults to sqlite.

## Resources

- [Using External Graders](http://edx.readthedocs.org/projects/ca/en/latest/external_graders.html)
- [Stanford External "Pull" Grader Example](https://github.com/Stanford-Online/xqueue_pull_ref)
